<!DOCTYPE html>
<html lang="zh-cn">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>cython上手记录</title>

            <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="神的笔记 Full Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="cython上手记录">

        <meta name="author" content="长恨安歌">

        <meta name="tags" content="python">
        <meta name="tags" content="cython">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="神的笔记">

	<meta property="og:type" content="article">
            <meta property="article:author" content="/author/chang-hen-an-ge.html">
	<meta property="og:url" content="/cython.html">
	<meta property="og:title" content="cython上手记录">
	<meta property="article:published_time" content="2019-08-01 00:00:00+08:00">
            <meta property="og:description" content="cython上手记录">

            <meta property="og:image" content="/theme/images/post-bg.jpg">
</head>

<body class="article-cython">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">神的笔记</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/theme/images/post-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>cython上手记录</h1>
                        <span class="meta">Posted by
                                <a href="/author/chang-hen-an-ge.html">长恨安歌</a>
                             on 周四 01 八月 2019
                        </span>
                            <span class="meta">Updated on 周四 01 八月 2019</span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p>cython是一个</p>
<h2>比较def, cdef, cpdef</h2>
<p>https://stackoverflow.com/questions/28362009/definition-of-def-cdef-and-cpdef-in-cython</p>
<p>The key difference is in where the function can be called from: def functions can be called from Python and Cython while cdef function can be called from Cython and C.</p>
<p>Both types of functions can be declared with any mixture of typed and untyped arguments, and in both cases the internals are compiled to C by Cython (and the compiled code should be very, very similar):</p>
<div class="highlight"><pre><span></span><span class="c1"># A Cython class for illustrative purposes</span>
<span class="n">cdef</span> <span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
   <span class="k">pass</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="nb">int</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">C</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">):</span>
    <span class="c1"># takes an integer, a &quot;C&quot; and an untyped generic python object</span>
    <span class="k">pass</span>

<span class="n">cdef</span> <span class="n">g</span><span class="p">(</span><span class="nb">int</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">C</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>


<p>In the example above, f will be visible to Python (once it has imported the Cython module) and g will not be and cannot be called from Python. g will translate into a C signature of:</p>
<div class="highlight"><pre><span></span>PyObject* some_name(int, struct __pyx_obj_11name_of_module_C *, PyObject*)
</pre></div>


<p>(where<code>struct __pyx_obj_11name_of_module_C *</code> is just the C struct that our class C is translated into). This allows it to be passed to C functions as a function pointer for example. In contrast f cannot (easily) be called from C.</p>
<h3>Restrictions on <code>cdef</code> functions:</h3>
<ul>
<li>cdef functions cannot be defined inside other functions - this is because there is no way of storing any captured variables in a C function pointer. E.g. the following code is illegal:</li>
</ul>
<div class="highlight"><pre><span></span># WON&#39;T WORK!
def g(a):
   cdef (int b):
      return a+b
</pre></div>


<ul>
<li>cdef functions cannot take <em>args and </em>*kwargs type arguments. This is because they cannot easily be translated into a C signature.</li>
</ul>
<h3>Advantages of cdef functions</h3>
<ul>
<li>
<p>cdef functions can take any type of argument, including those that have no Python equivalent (for example pointers). def functions cannot have these, since they must be callable from Python.</p>
</li>
<li>
<p>cdef functions can also specify a return type (if it is not specified then they return a Python object, PyObject* in C). def functions always return a Python object, so cannot specify a return type:</p>
</li>
</ul>
<div class="highlight"><pre><span></span>cdef int h(int* a):
    # specify a return type and take a non-Python compatible argument
    return a[0]
</pre></div>


<ul>
<li>cdef functions are quicker to call than def functions because they translate to a simple C function call.</li>
</ul>
<h3>cpdef functions</h3>
<p>cpdef functions cause Cython to generate a cdef function (that allows a quick function call from Cython) and a def function (which allows you to call it from Python). Interally the def function just calls the cdef function. In terms of the types of arguments allowed, cpdef functions have all the restrictions of both cdef and def functions.</p>
<h3>When to use a cdef function</h3>
<p>Once the function has been called there is no difference in the speed that the code inside a cdef and a def function runs at. Therefore, only use a cdef function if:</p>
<ul>
<li>You need to pass non-Python types in or out, or</li>
<li>You need to pass it to C as a function pointer, or</li>
<li>You are calling it often (so the sped-up function call is important) and you don't need to call it from Python.
Use a cpdef function when you are calling it often (so the sped-up function call is important) but you do need to call it from Python.</li>
</ul>
    </article>

        <div class="tags">
            <p>tags: <a href="/tag/python.html">python</a>, <a href="/tag/cython.html">cython</a></p>
        </div>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="#">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-you can add links in your config file fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.zhihu.com/people/dreamapple/activities">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-zhihu fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>. <br />        &copy;  长恨安歌
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

</body>

</html>